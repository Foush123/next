{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template theme_next/dashboard

    Next theme dashboard template.

    Context variables required for this template:
    * sitename - The name of the site
    * output - The core renderer for the page
    * bodyattributes - attributes for the body tag as a string of html attributes
    * sidepreblocks - HTML for the blocks
    * hasblocks - true if there are blocks on this page
    * user - The current user object
    * progress - User learning progress data
    * recent_activity - Recent user activity
}}

<div class="dashboard-container animate-fade-in">
    <!-- Welcome Section -->
    <div class="dashboard-card card-featured mb-4">
        <div class="card-header">
            <div>
                <h1 class="card-title">Welcome back, {{user.firstname}}!</h1>
                <p class="card-subtitle">Ready to continue your learning journey?</p>
            </div>
            <div class="card-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
        </div>
    </div>

    <!-- Learning Progress Grid -->
    <div class="dashboard-grid">
        <!-- Courses Completed Card -->
        <div class="dashboard-card card-small animate-fade-in-up">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <h3 class="card-title">Courses Completed</h3>
                    <p class="card-subtitle">Your achievements</p>
                </div>
            </div>
            <div class="metric-value">{{progress.completed_courses}}</div>
            <div class="metric-label">out of {{progress.enrolled_courses}} enrolled</div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill primary" style="width: {{#progress}}{{#if enrolled_courses}}{{completed_courses}}/{{enrolled_courses}}*100{{/if}}{{/progress}}%"></div>
                </div>
            </div>
        </div>

        <!-- Quiz Performance Card -->
        <div class="dashboard-card card-small animate-fade-in-up">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div>
                    <h3 class="card-title">Quiz Performance</h3>
                    <p class="card-subtitle">Average score</p>
                </div>
            </div>
            <div class="metric-value">{{#progress}}{{#if avg_quiz_score}}{{avg_quiz_score}}%{{else}}N/A{{/if}}{{/progress}}</div>
            <div class="metric-label">{{progress.quiz_attempts}} attempts</div>
            <div class="metric-change positive">
                <span class="change-icon">‚Üó</span>
                Keep it up!
            </div>
        </div>

        <!-- Learning Streak Card -->
        <div class="dashboard-card card-small animate-fade-in-up">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <div>
                    <h3 class="card-title">Learning Streak</h3>
                    <p class="card-subtitle">Days in a row</p>
                </div>
            </div>
            <div class="metric-value">7</div>
            <div class="metric-label">Current streak</div>
            <div class="metric-change positive">
                <span class="change-icon">üî•</span>
                On fire!
            </div>
        </div>

        <!-- Time Spent Card -->
        <div class="dashboard-card card-small animate-fade-in-up">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div>
                    <h3 class="card-title">Time Spent</h3>
                    <p class="card-subtitle">This week</p>
                </div>
            </div>
            <div class="metric-value">24h</div>
            <div class="metric-label">Total learning time</div>
            <div class="metric-change positive">
                <span class="change-icon">‚è±Ô∏è</span>
                +2h from last week
            </div>
        </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="dashboard-card card-large animate-fade-in-up">
        <div class="card-header">
            <h3 class="card-title">Recent Activity</h3>
            <button class="btn btn-ghost">View All</button>
        </div>
        <div class="recent-activity-list">
            {{#recent_activity}}
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="activity-content">
                    <h4 class="activity-title">{{fullname}}</h4>
                    <p class="activity-description">{{summary}}</p>
                    <span class="activity-date">{{#startdate}}{{startdate}}{{/startdate}}</span>
                </div>
                <div class="activity-action">
                    <button class="btn btn-primary btn-sm">Continue</button>
                </div>
            </div>
            {{/recent_activity}}
        </div>
    </div>

    <!-- Learning Analytics Chart -->
    <div class="dashboard-card card-large animate-fade-in-up">
        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">Learning Progress</h3>
                <div class="chart-controls">
                    <div class="time-selector">
                        <button class="time-btn active" data-period="1-month">1 Month</button>
                        <button class="time-btn" data-period="3-months">3 Months</button>
                        <button class="time-btn" data-period="6-months">6 Months</button>
                        <button class="time-btn" data-period="1-year">1 Year</button>
                    </div>
                </div>
            </div>
            <div class="chart-content">
                <div class="chart-placeholder">
                    <canvas id="learningProgressChart" width="800" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Blocks -->
    {{#hasblocks}}
    <div class="dashboard-sidebar">
        <div class="sidebar-blocks">
            {{{sidepreblocks}}}
        </div>
        <div class="sidebar-blocks">
            {{{sidepostblocks}}}
        </div>
    </div>
    {{/hasblocks}}
</div>

<style>
.dashboard-sidebar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.sidebar-blocks {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.recent-activity-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    background: rgba(248, 250, 252, 0.5);
    border-radius: 0.75rem;
    border: 1px solid rgba(226, 232, 240, 0.3);
    transition: all 0.3s ease;
}

.activity-item:hover {
    background: rgba(99, 102, 241, 0.05);
    border-color: rgba(99, 102, 241, 0.2);
    transform: translateY(-1px);
}

.activity-icon {
    width: 48px;
    height: 48px;
    border-radius: 0.75rem;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 0.25rem 0;
}

.activity-description {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0 0 0.5rem 0;
    line-height: 1.4;
}

.activity-date {
    font-size: 0.75rem;
    color: #94a3b8;
    font-weight: 500;
}

.activity-action {
    margin-left: 1rem;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}
</style>